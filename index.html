<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í† í° ê²Œì„ - í•µì‹¬ ì»¨ì…‰ í”„ë¡œí† íƒ€ì…</title>
    <style>
        body {
            font-family: monospace;
            max-width: 1000px;
            margin: 20px auto;
            padding: 20px;
            background: #1a1a1a;
            color: #eee;
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            border: 2px solid #444;
            background: #252525;
        }
        .card {
            display: inline-block;
            padding: 10px;
            margin: 5px;
            border: 2px solid #666;
            background: #333;
            cursor: pointer;
            min-width: 120px;
        }
        .card.selected {
            border-color: #4a9eff;
            background: #1a3a5a;
        }
        .card.grade-A {
            border-left: 4px solid #4a9eff;
        }
        .card.grade-C {
            border-left: 4px solid #ff9a4a;
        }
        .card-text {
            font-size: 14px;
        }
        .card-cost {
            font-size: 11px;
            color: #aaa;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            background: #444;
            color: #eee;
            border: 2px solid #666;
            cursor: pointer;
            font-family: monospace;
        }
        button:hover {
            background: #555;
        }
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .result {
            padding: 10px;
            margin: 10px 0;
            background: #1a1a1a;
            border-left: 4px solid #666;
        }
        .result.surge { border-left-color: #ff4a4a; }
        .result.perfect { border-left-color: #4aff4a; }
        .result.cut { border-left-color: #ffaa4a; }
        .log {
            font-size: 12px;
            color: #999;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ® í† í° ê²Œì„ - ì»¨ì…‰ ê²€ì¦ í”„ë¡œí† íƒ€ì…</h1>

    <div class="section">
        <h3>ğŸ“Š ê²Œì„ ìƒíƒœ</h3>
        <div>í„´: <span id="turn">1</span></div>
        <div>ì¶”ë¡  í’€: <span id="reasoning-pool">12</span> / 12</div>
        <div>ë±: <span id="deck-count">20</span>ì¥ | ë²„ë¦° ë±: <span id="discard-count">0</span>ì¥</div>
    </div>

    <div class="section">
        <h3>ğŸ–ï¸ ì•¡í‹°ë¸Œ í•¸ë“œ (5ì¥ ê³ ì •)</h3>
        <div id="hand"></div>
        <p style="font-size: 12px; color: #999;">í´ë¦­í•´ì„œ ì¹´ë“œ ì„ íƒ/í•´ì œ</p>
    </div>

    <div class="section">
        <h3>ğŸ“ ì¡°ë¦½ëœ í”„ë¡¬í”„íŠ¸</h3>
        <div id="prompt">
            <p style="color: #666;">ì¹´ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”...</p>
        </div>
        <div>
            ì„ íƒí•œ ì¹´ë“œ ìˆ˜: <span id="selected-count">0</span> |
            ì´ ë¹„ìš©: <span id="total-cost">0</span> / 12
        </div>
        <button id="execute-btn" onclick="executePrompt()" disabled>ğŸš€ í”„ë¡¬í”„íŠ¸ ì‹¤í–‰</button>
        <button onclick="clearSelection()">ğŸ”„ ì„ íƒ ì´ˆê¸°í™”</button>
    </div>

    <div class="section">
        <h3>âš¡ ì¶”ë¡  ê²°ê³¼</h3>
        <div id="result">
            <p style="color: #666;">í”„ë¡¬í”„íŠ¸ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”...</p>
        </div>
    </div>

    <div class="section">
        <h3>ğŸ“œ ê²Œì„ ë¡œê·¸</h3>
        <div id="log" class="log"></div>
    </div>

    <script>
        // ========== ë°ì´í„° êµ¬ì¡° ==========
        const CARD_POOL = [
            { id: 1, grade: 'A', type: 'target', text: 'ì  1ì²´', cost: 1 },
            { id: 2, grade: 'A', type: 'action', text: 'í”¼í•´ 3', cost: 2 },
            { id: 3, grade: 'A', type: 'action', text: 'ë°©ì–´ 5', cost: 2 },
            { id: 4, grade: 'A', type: 'target', text: 'ì  ì „ì²´', cost: 3 },
            { id: 5, grade: 'C', type: 'target', text: 'ëª¨ë‘ì—ê²Œ', cost: 3 },
            { id: 6, grade: 'C', type: 'modifier', text: 'ëœ¨ê±°ì›€', cost: 2 },
            { id: 7, grade: 'A', type: 'action', text: 'í”¼í•´ 2', cost: 1 },
            { id: 8, grade: 'A', type: 'modifier', text: 'ë¹ ë¥´ê²Œ', cost: 1 },
        ];

        let gameState = {
            turn: 1,
            reasoningPool: 12,
            hand: [],
            library: [],
            discardPile: [],
            selectedCards: new Set()
        };

        // ========== ì´ˆê¸°í™” ==========
        function initGame() {
            // ë± ìƒì„± (ì¹´ë“œ í’€ì„ ì—¬ëŸ¬ ë²ˆ ë³µì‚¬)
            gameState.library = [];
            for (let i = 0; i < 3; i++) {
                CARD_POOL.forEach(card => {
                    gameState.library.push({ ...card, uniqueId: `${card.id}-${i}` });
                });
            }
            shuffle(gameState.library);

            // ì´ˆê¸° í•¸ë“œ 5ì¥
            drawCards(5);
            updateUI();
            log('ê²Œì„ ì‹œì‘! í•¸ë“œ 5ì¥ ë“œë¡œìš°');
        }

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function drawCards(count) {
            for (let i = 0; i < count; i++) {
                if (gameState.library.length === 0) {
                    // ë±ì´ ë¹„ì—ˆìœ¼ë©´ ë²„ë¦° ë± ì…”í”Œí•´ì„œ ì¬í™œìš©
                    if (gameState.discardPile.length > 0) {
                        log('âŸ³ ë± ì†Œì§„! ë²„ë¦° ë±ì„ ì…”í”Œí•˜ì—¬ ì¬í™œìš©');
                        gameState.library = [...gameState.discardPile];
                        gameState.discardPile = [];
                        shuffle(gameState.library);
                    } else {
                        log('âš ï¸ ë” ì´ìƒ ë½‘ì„ ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤!');
                        break;
                    }
                }

                const card = gameState.library.shift();
                gameState.hand.push(card);
            }
        }

        // ========== UI ì—…ë°ì´íŠ¸ ==========
        function updateUI() {
            // ìƒíƒœ í‘œì‹œ
            document.getElementById('turn').textContent = gameState.turn;
            document.getElementById('reasoning-pool').textContent = gameState.reasoningPool;
            document.getElementById('deck-count').textContent = gameState.library.length;
            document.getElementById('discard-count').textContent = gameState.discardPile.length;

            // í•¸ë“œ ë Œë”ë§
            const handEl = document.getElementById('hand');
            handEl.innerHTML = '';
            gameState.hand.forEach(card => {
                const cardEl = document.createElement('div');
                cardEl.className = `card grade-${card.grade}`;
                if (gameState.selectedCards.has(card.uniqueId)) {
                    cardEl.classList.add('selected');
                }
                cardEl.innerHTML = `
                    <div class="card-text">[${card.grade}: ${card.text}]</div>
                    <div class="card-cost">ë¹„ìš©: ${card.cost}</div>
                `;
                cardEl.onclick = () => toggleCard(card.uniqueId);
                handEl.appendChild(cardEl);
            });

            // í”„ë¡¬í”„íŠ¸ í‘œì‹œ
            updatePrompt();
        }

        function toggleCard(uniqueId) {
            if (gameState.selectedCards.has(uniqueId)) {
                gameState.selectedCards.delete(uniqueId);
            } else {
                gameState.selectedCards.add(uniqueId);
            }
            updatePrompt();
            updateUI();
        }

        function clearSelection() {
            gameState.selectedCards.clear();
            updatePrompt();
            updateUI();
        }

        function updatePrompt() {
            const selectedArray = gameState.hand.filter(c => gameState.selectedCards.has(c.uniqueId));
            const totalCost = selectedArray.reduce((sum, c) => sum + c.cost, 0);

            const promptEl = document.getElementById('prompt');
            if (selectedArray.length === 0) {
                promptEl.innerHTML = '<p style="color: #666;">ì¹´ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”...</p>';
            } else {
                const text = selectedArray.map(c => `[${c.grade}: ${c.text}]`).join(' + ');
                promptEl.innerHTML = `<p>${text}</p>`;
            }

            document.getElementById('selected-count').textContent = selectedArray.length;
            document.getElementById('total-cost').textContent = totalCost;

            // ì‹¤í–‰ ë²„íŠ¼ í™œì„±í™”
            const executeBtn = document.getElementById('execute-btn');
            executeBtn.disabled = selectedArray.length === 0;
        }

        // ========== ì¶”ë¡  ì‹œìŠ¤í…œ ==========
        function executePrompt() {
            const selectedArray = gameState.hand.filter(c => gameState.selectedCards.has(c.uniqueId));
            if (selectedArray.length === 0) return;

            const totalCost = selectedArray.reduce((sum, c) => sum + c.cost, 0);
            const diff = gameState.reasoningPool - totalCost;

            let resultType, resultText, usedTokens, cutTokens = [];

            if (diff > 0) {
                // ê³¼ì¶”ë¡  (Surge)
                resultType = 'surge';
                resultText = `ğŸ”¥ SURGE! (ë‚¨ì€ ì¶”ë¡ : ${diff})`;
                resultText += `<br>â†’ ë³´ë„ˆìŠ¤: í”¼í•´ +30%`;
                usedTokens = selectedArray;
            } else if (diff === 0) {
                // ì™„ì „ ì¶”ë¡  (Perfect)
                resultType = 'perfect';
                resultText = `âœ¨ PERFECT! (ì •í™•íˆ ì¼ì¹˜)`;
                resultText += `<br>â†’ ë³´ë„ˆìŠ¤: íš¨ê³¼ 2íšŒ ë°œë™`;
                usedTokens = selectedArray;
            } else {
                // ì¶”ë¡  ì‹¤íŒ¨ (Cut)
                resultType = 'cut';
                const cutCount = Math.ceil(Math.abs(diff) / 2); // ê°„ë‹¨íˆ 2ë¡œ ë‚˜ëˆ”
                const actualCut = Math.min(cutCount, selectedArray.length);

                cutTokens = selectedArray.slice(-actualCut);
                usedTokens = selectedArray.slice(0, -actualCut);

                resultText = `âš ï¸ CUT! (ë¶€ì¡±í•œ ì¶”ë¡ : ${Math.abs(diff)})`;
                resultText += `<br>â†’ ë’¤ì—ì„œ ${actualCut}ì¥ ì œê±°ë¨: `;
                resultText += cutTokens.map(c => `[${c.text}]`).join(', ');
            }

            // ê²°ê³¼ í‘œì‹œ
            const resultEl = document.getElementById('result');
            resultEl.innerHTML = `
                <div class="result ${resultType}">
                    <strong>${resultText}</strong>
                    <br><br>
                    <strong>ì‹¤ì œ ì‹¤í–‰ëœ í† í°:</strong><br>
                    ${usedTokens.map(c => `[${c.grade}: ${c.text}] (ë¹„ìš© ${c.cost})`).join('<br>')}
                    ${usedTokens.length === 0 ? '<span style="color: #999;">ì—†ìŒ (ëª¨ë‘ ì˜ë ¸ìŠµë‹ˆë‹¤)</span>' : ''}
                </div>
            `;

            log(`í„´ ${gameState.turn}: ${resultType.toUpperCase()} - ${selectedArray.length}ì¥ ì‚¬ìš©, ì´ ë¹„ìš© ${totalCost}`);

            // í„´ ì¢…ë£Œ ì²˜ë¦¬
            endTurn(selectedArray);
        }

        // ========== í„´ ì¢…ë£Œ ==========
        function endTurn(usedCards) {
            // 1. ì‚¬ìš©í•œ ì¹´ë“œ â†’ ë²„ë¦° ë±
            gameState.discardPile.push(...usedCards);

            // 2. í•¸ë“œì—ì„œ ì‚¬ìš©í•œ ì¹´ë“œ ì œê±°
            gameState.hand = gameState.hand.filter(c => !gameState.selectedCards.has(c.uniqueId));

            // 3. ë¹ˆ ìŠ¬ë¡¯ë§Œí¼ ë³´ì¶©
            const drawCount = 5 - gameState.hand.length;
            log(`â†’ ì‚¬ìš©í•œ ${usedCards.length}ì¥ì€ ë²„ë¦¼, ë¯¸ì‚¬ìš© ${gameState.hand.length}ì¥ ìœ ì§€, ${drawCount}ì¥ ë³´ì¶©`);

            drawCards(drawCount);

            // 4. ì„ íƒ ì´ˆê¸°í™” ë° ë‹¤ìŒ í„´
            gameState.selectedCards.clear();
            gameState.turn++;
            gameState.reasoningPool = 12; // ì¶”ë¡  í’€ ë¦¬ì…‹

            updateUI();
            log(`--- í„´ ${gameState.turn} ì‹œì‘ ---`);
        }

        // ========== ë¡œê·¸ ==========
        function log(message) {
            const logEl = document.getElementById('log');
            const entry = document.createElement('div');
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logEl.insertBefore(entry, logEl.firstChild);
        }

        // ========== ê²Œì„ ì‹œì‘ ==========
        initGame();
    </script>
</body>
</html>
